{% extends "base.html" %}

{% block title %}Shot List - YouTube Creator Tools{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-6 py-8">
    <div class="flex justify-between items-center mb-8">
        <h1 class="text-4xl font-bold tracking-tight">Shot List</h1>

        <div class="flex gap-3">
            <button
                onclick="document.getElementById('create-project-modal').classList.remove('hidden')"
                class="px-4 py-3 bg-yt-card text-yt-text font-semibold rounded-lg hover:bg-yt-hover transition-all"
            >
                + New Project
            </button>
            <button
                onclick="document.getElementById('create-modal').classList.remove('hidden')"
                class="px-6 py-3 bg-yt-accent text-black font-semibold rounded-lg hover:opacity-90 transition-all"
            >
                + New Video
            </button>
        </div>
    </div>

    <!-- Project Tabs -->
    <div class="flex gap-2 mb-8 overflow-x-auto pb-2">
        <a
            href="/shotlist"
            class="px-4 py-2 rounded-lg text-sm font-medium transition-all whitespace-nowrap {% if not selected_project_id %}bg-yt-card text-white{% else %}bg-yt-bg text-yt-text-secondary hover:text-yt-text{% endif %}"
        >
            All Videos
        </a>
        {% for project in projects %}
        <a
            href="/shotlist?project_id={{ project.id }}"
            class="px-4 py-2 rounded-lg text-sm font-medium transition-all whitespace-nowrap {% if selected_project_id == project.id %}bg-yt-card text-white{% else %}bg-yt-bg text-yt-text-secondary hover:text-yt-text{% endif %}"
        >
            {{ project.name }}
        </a>
        {% endfor %}
    </div>

    {% if videos %}
    <div class="space-y-3">
        {% for video in videos %}
        <div class="bg-yt-card border border-gray-800 rounded-xl p-6 hover:bg-yt-hover transition-all group">
            <div class="flex justify-between items-start">
                <a href="/shotlist/video/{{ video.id }}" class="flex-1">
                    <div>
                        <h2 class="text-2xl font-bold text-yt-text group-hover:text-white transition-colors">
                            {{ video.title }}
                        </h2>
                        {% if video.global_vibe %}
                        <p class="text-yt-text-secondary mt-2">{{ video.global_vibe }}</p>
                        {% endif %}
                    </div>
                </a>
                <div class="flex items-center gap-3">
                    <a href="/shotlist/video/{{ video.id }}" class="text-gray-600 group-hover:text-gray-400 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </a>
                    <button
                        onclick="deleteVideo('{{ video.id }}', this.closest('.bg-yt-card'))"
                        class="text-gray-600 hover:text-red-500 transition-colors"
                    >
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-20">
        <div class="text-yt-text-secondary text-lg mb-4">No videos yet</div>
        <p class="text-gray-600">Create your first video to get started</p>
    </div>
    {% endif %}
</div>

<!-- Create Project Modal -->
<div id="create-project-modal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50">
    <div class="bg-yt-card border border-gray-800 rounded-2xl p-8 max-w-md w-full mx-4">
        <h2 class="text-2xl font-bold mb-6">New Project</h2>

        <form onsubmit="handleCreateProject(event)">
            <label class="block mb-2 text-sm font-medium text-yt-text-secondary">Project Name</label>
            <input
                type="text"
                name="name"
                required
                autofocus
                class="w-full px-4 py-3 bg-yt-bg border border-gray-800 rounded-lg text-yt-text focus:outline-none focus:border-yt-accent transition-colors mb-4"
                placeholder="Tech & AI Channel"
            >

            <label class="block mb-2 text-sm font-medium text-yt-text-secondary">Description (optional)</label>
            <textarea
                name="description"
                rows="3"
                class="w-full px-4 py-3 bg-yt-bg border border-gray-800 rounded-lg text-yt-text focus:outline-none focus:border-yt-accent transition-colors resize-none"
                placeholder="Videos about AI and technology"
            ></textarea>

            <div class="flex gap-3 mt-6">
                <button
                    type="button"
                    onclick="document.getElementById('create-project-modal').classList.add('hidden')"
                    class="flex-1 px-4 py-3 bg-yt-bg text-yt-text rounded-lg hover:bg-yt-hover transition-all"
                >
                    Cancel
                </button>
                <button
                    type="submit"
                    class="flex-1 px-4 py-3 bg-yt-accent text-black font-semibold rounded-lg hover:opacity-90 transition-all"
                >
                    Create
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Create Video Modal -->
<div id="create-modal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50">
    <div class="bg-yt-card border border-gray-800 rounded-2xl p-8 max-w-md w-full mx-4">
        <h2 class="text-2xl font-bold mb-6">New Video</h2>

        <form onsubmit="handleCreateVideo(event)">
            <label class="block mb-2 text-sm font-medium text-yt-text-secondary">Video Title</label>
            <input
                type="text"
                name="title"
                required
                autofocus
                class="w-full px-4 py-3 bg-yt-bg border border-gray-800 rounded-lg text-yt-text focus:outline-none focus:border-yt-accent transition-colors mb-4"
                placeholder="My Awesome Video"
            >

            <label class="block mb-2 text-sm font-medium text-yt-text-secondary">Project</label>
            <select
                name="project_id"
                class="w-full px-4 py-3 bg-yt-bg border border-gray-800 rounded-lg text-yt-text focus:outline-none focus:border-yt-accent transition-colors"
            >
                <option value="">No Project</option>
                {% for project in projects %}
                <option value="{{ project.id }}" {% if selected_project_id == project.id %}selected{% endif %}>{{ project.name }}</option>
                {% endfor %}
            </select>

            <div class="flex gap-3 mt-6">
                <button
                    type="button"
                    onclick="document.getElementById('create-modal').classList.add('hidden')"
                    class="flex-1 px-4 py-3 bg-yt-bg text-yt-text rounded-lg hover:bg-yt-hover transition-all"
                >
                    Cancel
                </button>
                <button
                    type="submit"
                    class="flex-1 px-4 py-3 bg-yt-accent text-black font-semibold rounded-lg hover:opacity-90 transition-all"
                >
                    Create
                </button>
            </div>
        </form>
    </div>
</div>

<script>
let isSubmitting = false;

function handleCreateProject(event) {
    event.preventDefault();

    if (isSubmitting) return;
    isSubmitting = true;

    const form = event.target;
    const formData = new FormData(form);

    fetch('/api/shotlist/projects', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            window.location.reload();
        }
    })
    .catch(error => {
        console.error('Error:', error);
        isSubmitting = false;
    });
}

function handleCreateVideo(event) {
    event.preventDefault();

    if (isSubmitting) return;
    isSubmitting = true;

    const form = event.target;
    const formData = new FormData(form);

    fetch('/api/shotlist/videos', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success && data.video) {
            window.location.href = `/shotlist/video/${data.video.id}`;
        }
    })
    .catch(error => {
        console.error('Error:', error);
        isSubmitting = false;
    });
}

function deleteVideo(videoId, element) {
    if (confirm('Delete this video and all its shots?')) {
        fetch(`/api/shotlist/videos/${videoId}`, {
            method: 'DELETE'
        }).then(() => {
            element.remove();
        });
    }
}
</script>
{% endblock %}
